<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運転計画モニタ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            color: #01977a;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        input[type="date"] {
            padding: 5px;
            border: 1px solid #01977a;
            border-radius: 4px;
        }
        button {
            background-color: #01977a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #017a64;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #01977a;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>運転計画モニタ</h1>
		<button onclick="window.location.href='toppage.html'">メインメニューに戻る</button>
        <div class="controls">
            <input type="date" id="date-picker">
            <div>
                <button onclick="fetchEvents()">予定を取得</button>
                <button onclick="showAllEvents()">全ての予定を表示</button>
            </div>
        </div>
        <div id="filtered-events">
            <h2>選択日の予定</h2>
            <table id="events-table">
                <thead>
                    <tr>
                        <th>日付</th>
                        <th>タイトル</th>
                        <th>説明</th>
                    </tr>
                </thead>
                <tbody id="events-body">
                </tbody>
            </table>
        </div>
        <div id="all-events" style="display: none;">
            <h2>全ての予定一覧</h2>
            <table id="all-events-table">
                <thead>
                    <tr>
                        <th>日付</th>
                        <th>内容</th>
                    </tr>
                </thead>
                <tbody id="all-events-body">
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const API_KEY = 'YOUR_API_KEY';
        const CLIENT_ID = 'YOUR_CLIENT_ID';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(function () {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            }, function(error) {
                console.log(JSON.stringify(error, null, 2));
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (!isSignedIn) {
                gapi.auth2.getAuthInstance().signIn();
            }
        }

        function fetchEvents() {
            const date = document.getElementById('date-picker').value;
            if (!date) {
                alert('日付を選択してください');
                return;
            }

            const startDate = new Date(date);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 1);

            gapi.client.calendar.events.list({
                'calendarId': 'primary',
                'timeMin': startDate.toISOString(),
                'timeMax': endDate.toISOString(),
                'showDeleted': false,
                'singleEvents': true,
                'orderBy': 'startTime'
            }).then(function(response) {
                const events = response.result.items;
                updateTable(events);
                document.getElementById('filtered-events').style.display = 'block';
                document.getElementById('all-events').style.display = 'none';
            });
        }

        function showAllEvents() {
            gapi.client.calendar.events.list({
                'calendarId': 'primary',
                'timeMin': (new Date()).toISOString(),
                'showDeleted': false,
                'singleEvents': true,
                'maxResults': 100,
                'orderBy': 'startTime'
            }).then(function(response) {
                const events = response.result.items;
                updateAllEventsTable(events);
                document.getElementById('filtered-events').style.display = 'none';
                document.getElementById('all-events').style.display = 'block';
            });
        }

        function updateTable(events) {
            const tableBody = document.getElementById('events-body');
            tableBody.innerHTML = '';
            events.forEach(event => {
                const row = tableBody.insertRow();
                const dateCell = row.insertCell(0);
                const titleCell = row.insertCell(1);
                const descriptionCell = row.insertCell(2);

                const startDateTime = new Date(event.start.dateTime || event.start.date);
                dateCell.textContent = startDateTime.toLocaleString();
                titleCell.textContent = event.summary;
                descriptionCell.textContent = event.description || '';
            });
        }

        function updateAllEventsTable(events) {
            const tableBody = document.getElementById('all-events-body');
            tableBody.innerHTML = '';
            events.forEach(event => {
                const row = tableBody.insertRow();
                const dateCell = row.insertCell(0);
                const contentCell = row.insertCell(1);

                const startDateTime = new Date(event.start.dateTime || event.start.date);
                dateCell.textContent = startDateTime.toLocaleDateString();
                contentCell.textContent = event.summary;
            });
        }

        handleClientLoad();
    </script>
</body>

</html>
