<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>JAL ãƒ•ãƒ©ã‚¤ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }

    h1 {
      color: #003366;
    }

    .search-box {
      margin-bottom: 20px;
    }

    input {
      padding: 8px;
      font-size: 16px;
      width: 200px;
    }

    .day-section {
      margin-bottom: 40px;
    }

    h2 {
      margin-top: 30px;
      color: #005599;
    }

    .flight {
      background: white;
      padding: 10px;
      margin-bottom: 10px;
      border-left: 5px solid #005599;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .flight span {
      display: block;
      margin-bottom: 3px;
    }

    #json-debug {
      background: #eef;
      white-space: pre-wrap;
      padding: 10px;
      border: 1px solid #ccc;
      font-size: 12px;
      margin-top: 50px;
    }
  </style>
</head>
<body>
  <h1>JAL ãƒ•ãƒ©ã‚¤ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>

  <div class="search-box">
    <label>ä¾¿åã§æ¤œç´¢ï¼š</label>
    <input type="text" id="search" placeholder="ä¾‹ï¼šJL2050">
  </div>

  <div id="schedule">èª­ã¿è¾¼ã¿ä¸­...</div>

  <h2>ğŸ” å–å¾—ã—ãŸAPIãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰</h2>
  <pre id="json-debug">èª­ã¿è¾¼ã¿ä¸­...</pre>

  <script>
    const token = "wvzxbmrc468he3y0p93ufz8ovhcqn5sauiiuixepg22wluhptpc42o78xfe38onh"; // â† ã‚ãªãŸã®APIã‚­ãƒ¼ã‚’å…¥åŠ›
    const apiUrl = `https://api.odpt.org/api/v4/odpt:FlightSchedule?odpt:operator=odpt.Operator:JAL&acl:consumerKey=${token}`;

    const airportMap = {
      "FUK": "ç¦å²¡ç©ºæ¸¯",
      "ITM": "å¤§é˜ªå›½éš›ç©ºæ¸¯ï¼ˆä¼Šä¸¹ï¼‰",
      "HND": "æ±äº¬å›½éš›ç©ºæ¸¯ï¼ˆç¾½ç”°ï¼‰",
      "NRT": "æˆç”°å›½éš›ç©ºæ¸¯",
      "CTS": "æ–°åƒæ­³ç©ºæ¸¯",
      "KIX": "é–¢è¥¿å›½éš›ç©ºæ¸¯"
    };

    const dayMap = {
      "Monday": "æœˆæ›œæ—¥",
      "Tuesday": "ç«æ›œæ—¥",
      "Wednesday": "æ°´æ›œæ—¥",
      "Thursday": "æœ¨æ›œæ—¥",
      "Friday": "é‡‘æ›œæ—¥",
      "Saturday": "åœŸæ›œæ—¥",
      "Sunday": "æ—¥æ›œæ—¥",
      "Weekday": "å¹³æ—¥",
      "Holiday": "ä¼‘æ—¥"
    };

    const scheduleContainer = document.getElementById('schedule');
    const debugOutput = document.getElementById('json-debug');
    const searchInput = document.getElementById('search');
    let allFlightDivs = [];

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        // JSONãã®ã¾ã¾è¡¨ç¤º
        debugOutput.textContent = JSON.stringify(data, null, 2);

        scheduleContainer.innerHTML = '';
        allFlightDivs = [];

        data.forEach(item => {
          const date = item["dc:date"]?.split("T")[0] || "æ—¥ä»˜ä¸æ˜";
          const calendar = item["odpt:calendar"]?.split(":")[1] || "æ›œæ—¥ä¸æ˜";
          const weekday = dayMap[calendar] || calendar;

          const originCode = item["odpt:originAirport"].split(":")[1];
          const destCode = item["odpt:destinationAirport"].split(":")[1];
          const origin = airportMap[originCode] || originCode;
          const dest = airportMap[destCode] || destCode;

          const section = document.createElement("div");
          section.className = "day-section";

          const title = document.createElement("h2");
          title.textContent = `${weekday}ï¼ˆ${date}ï¼‰`;
          section.appendChild(title);

          (item["odpt:flightScheduleObject"] || []).forEach(flight => {
            const flightNum = flight["odpt:flightNumber"][0];
            const originTime = flight["odpt:originTime"];
            const destTime = flight["odpt:destinationTime"];
            const aircraft = flight["odpt:aircraftType"];
            const validFrom = flight["odpt:isValidFrom"]?.split("T")[0] || "";
            const validTo = flight["odpt:isValidTo"]?.split("T")[0] || "";

            const flightDiv = document.createElement("div");
            flightDiv.className = "flight";
            flightDiv.setAttribute("data-flight", flightNum.toUpperCase());

            flightDiv.innerHTML = `
              <span><strong>ä¾¿åï¼š</strong>${flightNum}</span>
              <span><strong>å‡ºç™ºï¼š</strong>${origin} ${originTime}</span>
              <span><strong>åˆ°ç€ï¼š</strong>${dest} ${destTime}</span>
              <span><strong>æ©Ÿæï¼š</strong>${aircraft}</span>
              <span><strong>é‹è¡ŒæœŸé–“ï¼š</strong>${validFrom} ï½ ${validTo}</span>
            `;

            section.appendChild(flightDiv);
            allFlightDivs.push(flightDiv);
          });

          scheduleContainer.appendChild(section);
        });
      })
      .catch(err => {
        debugOutput.textContent = `APIå–å¾—ã‚¨ãƒ©ãƒ¼:\n${err}`;
        scheduleContainer.innerHTML = `<p style="color:red;">APIãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`;
      });

    searchInput.addEventListener("input", () => {
      const keyword = searchInput.value.trim().toUpperCase();
      allFlightDivs.forEach(div => {
        const flight = div.getAttribute("data-flight");
        div.style.display = keyword === "" || flight.includes(keyword) ? "block" : "none";
      });
    });
  </script>
</body>
</html>
