
<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=0.5" />
    <link rel="stylesheet" href="tid.css">
	<title>京成線在線モニタ</title>
    <script type="text/javascript">
        let linedata =
            {
                "keisei":
                {
                    uri: "keisei",
                    line_id: "keisei",
                    line_name: "京成本線",
                    sections:
                    [
                        {
                            stop_id: "E001",
                            stop_name: "上野",
                            tracks: "M-4,-1H6 M-4,1H6 M5,-1L6,1 M5,1L6,-1 M-4,-3H3L4,-1 M-4,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U001", "D003"]
                        },
                        {
                            stop_id: "E003",
                            stop_name: "日暮里",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U003", "D004"]
                        },
                        {
                            stop_id: "E004",
                            stop_name: "新三河島",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U004", "D005"]
                        },
                        {
                            stop_id: "E005",
                            stop_name: "町屋",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U005", "D006"]
                        },
                        {
                            stop_id: "E006",
                            stop_name: "千住大橋",
                            tracks: "M-6,-1H6 M-6,1H6 M-6,1L-5,-1 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U006", "D007"]
                        },
                        {
                            stop_id: "E007",
                            stop_name: "京成関屋",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U007", "D008"]
                        },
                        {
                            stop_id: "E008",
                            stop_name: "堀切菖蒲",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U008", "D009"]
                        },
                        {
                            stop_id: "E009",
                            stop_name: "お花茶屋",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U009", "D010"]
                        },
                        {
                            stop_id: "E010",
                            stop_name: "青砥",
                            tracks: "M-6,-1L-5,-3H6 M-6,1H6 M-6,3L-4,-1H6 M-5,5L-4,3H6 M3,-1L5,5H6 M5,3L5.7,5  M4,-3L5,-1 M2,1L3,3 M2,3L3,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["V010","U010", "D011","W011"]
                        },
                        {
                            stop_id: "E011",
                            stop_name: "高砂",
                            tracks: "M-6,-3H5L6,-1 M-6,-1H5 M-6,1H6 M-6,3H6 M-4,-5H4L5,-7 M-5,1L-4,3 M-5,-1L-4,-3 M2,-1L3,1 M2,1L3,-1 M2,3L3,1 M3,-3L4,-1M3,-1L4,-3 M4.5,1L5.5,3 M4,1L5,-5H5.5",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U011", "D012"]
                        },
                        {
                            stop_id: "E012",
                            stop_name: "京成小岩",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,1L-3,-1 M-5,-1L-4,-3H3L4,-1 M-5,1L-4,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U012", "D013"]
                        },
                        {
                            stop_id: "E013",
                            stop_name: "江戸川",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U013", "D014"]
                        },
                        {
                            stop_id: "E014",
                            stop_name: "国府台",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },                     
                        {
                            section_id: ["U014", "D015"]
                        },
                        {
                            stop_id: "E015",
                            stop_name: "市川真間",
                            tracks: "M-6,-1H6 M-6,1H6 M-6,1L-5,-1 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U015", "D016"]
                        },
                        {
                            stop_id: "E016",
                            stop_name: "菅野",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U016", "D017"]
                        },
                        {
                            stop_id: "E017",
                            stop_name: "京成八幡",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U017", "D018"]
                        },
                        {
                            stop_id: "E018",
                            stop_name: "鬼越",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U018", "D019"]
                        },
                        {
                            stop_id: "E019",
                            stop_name: "京成中山",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U019", "D020"]
                        },
                        {
                            stop_id: "E020",
                            stop_name: "東中山",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,1L-3,-1 M-5,-1L-4,-3H3L4,-1 M-5,1L-4,3H3L4,1 M2,-1L3,1 M3,-1L4,-3 M3,-3H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U020", "D021"]
                        },
                        {
                            stop_id: "E021",
                            stop_name: "京成西船",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U021", "D022"]
                        },
                        {
                            stop_id: "E022",
                            stop_name: "海神",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U022", "D023"]
                        },
                        {
                            stop_id: "E023",
                            stop_name: "京成船橋",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U023", "D024"]
                        },
                        {
                            stop_id: "E024",
                            stop_name: "大神宮下",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U024", "D025"]
                        },
                        {
                            stop_id: "E025",
                            stop_name: "船橋競馬",
                            tracks: "M-6,-1H6 M-6,1L-5,3H5L6,1 M-4,3L-3,1H3L4,3 M-4,-1L-3,-3H3L4,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U025", "D026"]
                        },
                        {
                            stop_id: "E026",
                            stop_name: "谷津",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U026", "D027"]
                        },
                        {
                            stop_id: "E027",
                            stop_name: "津田沼",
                            tracks: "M-6,-1H6 M-6,1L-4,5H4L6,1 M-6,-5L-5,-3H4L5,-5H6 M-4,-3L-3,-5H3 M-3,-1L-2,1H2L4.5,-1 M-6,1H-3L-2,3H3.5L5.5,-3H6 M2,5L3,3 M2,3L3,5 M2,1L4,-3 M2,-1L3.5,-2 M-6,0H-2.5 M-3.5,0L-3,1",
                            plats: [-2,0,2]
                        },
                        {
                            section_id: ["U027", "D028"]
                        },
                        {
                            stop_id: "E028",
                            stop_name: "大久保",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U028", "D029"]
                        },
                        {
                            stop_id: "E029",
                            stop_name: "実籾",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U029", "D030"]
                        },
                        {
                            stop_id: "E030",
                            stop_name: "八千代台",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,1L-3,-1 M-5,-1L-4,-3H3L4,-1 M-5,1L-4,3H3L4,1 M5,1L6,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U030", "D031"]
                        },
                        {
                            stop_id: "E031",
                            stop_name: "大和田",
                            tracks: "M-6,-1H6 M-6,1H6 M2.5,-1L3,0H6 M2.5,1L3,0",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U031", "D032"]
                        },
                        {
                            stop_id: "E032",
                            stop_name: "勝田台",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U032", "D033"]
                        },
                        {
                            stop_id: "E033",
                            stop_name: "志津",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U033", "D034"]
                        },
                        {
                            stop_id: "E034",
                            stop_name: "ﾕｰｶﾘが丘",
                            tracks: "M-6,-1H6 M-6,1H6 M-5,1L-4,3H4L5,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U034", "D035"]
                        },
                        {
                            stop_id: "E035",
                            stop_name: "京成臼井",
                            tracks: "M-6,-1H6 M-6,1H6 M2.5,-1L3,0H6 M2.5,1L3,0",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U035", "D036"]
                        },
                        {
                            stop_id: "E036",
                            stop_name: "京成佐倉",
                            tracks: "M-6,-1H6 M-6,1H6 M-6,-1L-5,-3H5L6,-1 M-6,1L-5,3H5L6,1 M4,1L5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U036", "D037"]
                        },
                        {
                            stop_id: "E037",
                            stop_name: "大佐倉",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U037", "D038"]
                        },
                        {
                            stop_id: "E038",
                            stop_name: "酒々井",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U038", "D039"]
                        },
                        {
                            stop_id: "E039",
                            stop_name: "宗吾参道",
                            tracks: "M-6,-1H6 M-6,1H6 M5,1L6,-1 M-6,-1L-5,1 M-3,1L-2,-1 M-4.5,1L-3.5,3 M-4.5,3L-3.5,1 M-5,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U039", "D040"]
                        },
                        {
                            stop_id: "E040",
                            stop_name: "公津の杜",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U040", "D041"]
                        },
                        {
                            stop_id: "E041",
                            stop_name: "京成成田",
                            tracks: "M-6,-1H6 M-6,1H-4.5L-3.5,3H5L6,1 M-3,3L-2,1H3L4,3 M-6,-1L-5,1 M-6,1L-5,-1 M3,1L4,-1",
                            plats: [-1,0,1]
                        },
                        {
                            section_id: ["U041", "D043"]
                        },
                        {
                            stop_id: "E043",
                            stop_name: "駒井野",
                            tracks: "M-6,-1H6 M-6,1H6 M2,-1L3,-3 M2,1L4,-3",
                            plats: []
                        },
                        {
                            section_id: ["K043", "D046"]
                        },
                        {
                            stop_id: "E046",
                            stop_name: "東成田",
                            tracks: "M-6,-1H5L6,0 M-6,1H4 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H4 M-6,-1L-5,1 M-6,1L-5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U046"]
                        },
                        {
                            stop_id: "E130",
                            stop_name: "芝山千代田",
                            tracks: "M-6,0L-5,-1H4",
                            plats: [-1]
                        }
                    ]
                },
                "oshiage":
                {
                    uri: "oshiage",
                    line_id: "oshiage",
                    line_name: "押上線",
                    sections:
                    [
                        {
                            stop_id: "E047",
                            stop_name: "押上",
                            tracks: "M-6,-1H6 M-6,1H6 M-6,-1L-5,-3H5L6,-1 M-6,1L-5,3H5L6,1 M-5,-1L-4,1 M-5,1L-4,-1 M4,-1L5,1 M4,1L5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U047", "D048"]
                        },
                        {
                            stop_id: "E048",
                            stop_name: "京成曳舟",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U048", "D049"]
                        },
                        {
                            stop_id: "E049",
                            stop_name: "八広",
                            tracks: "M-6,-1H6 M-6,1H6 M-6,-1L-5,-3H5L6,-1 M-6,1L-5,-1 M5,-1L6,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U049", "D050"]
                        },
                        {
                            stop_id: "E050",
                            stop_name: "四ツ木",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U050", "D051"]
                        },
                        {
                            stop_id: "E051",
                            stop_name: "京成立石",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U051", "S010"]
                        },
                        {
                            stop_id: "E010",
                            stop_name: "青砥",
                            tracks: "M-6,-1H6 M-6,1L-5,3H6 M-5,-3H6 M-5,1H6   M3,-1L5,5H6 M5,3L5.7,5  M4,-3L5,-1 M2,1L3,3 M2,3L3,1",
                            plats: [-1,1]
                        },
                    ]
                },
                "hokuso":
                {
                    uri: "hokuso",
                    line_id: "hokuso",
                    line_name: "北総線",
                    sections:
                    [
                        {
                            stop_id: "E010",
                            stop_name: "青砥",
                            tracks: "M-6,-1L-5,-3H6 M-6,1H6 M-6,3L-4,-1H6 M-5,5L-4,3H6 M3,-1L5,5H6 M5,3L5.7,5  M4,-3L5,-1 M2,1L3,3 M2,3L3,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["V010","U010", "D011","W011"]
                        },
                        {
                            stop_id: "E011",
                            stop_name: "高砂",
                            tracks: "M-6,-3H6 M-6,-1H6 M-6,1H5 M-6,3H5.5L6,1 M-4,-5H4L5,-7 M-5,1L-4,3 M-5,-1L-4,-3 M2,-1L3,1 M2,1L3,-1 M2,3L3,1 M3,-3L4,-1M3,-1L4,-3 M4.5,1L5,3 M4,1L5,-5H5.5",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["K011","D211"]
                        },
                        {
                            stop_id: "E211",
                            stop_name: "新柴又",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U211","D140"]
                        },
                        {
                            stop_id: "E140",
                            stop_name: "矢切",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H3L4,1 M4.5,1L5.5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U140","D212"]
                        },
                        {
                            stop_id: "E212",
                            stop_name: "北国分",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U212","D213"]
                        },
                        {
                            stop_id: "E213",
                            stop_name: "秋山",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U213","D148"]
                        },
                        {
                            stop_id: "E148",
                            stop_name: "東松戸",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H3L4,1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U148","D214"]
                        },
                        {
                            stop_id: "E214",
                            stop_name: "松飛台",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U214","D215"]
                        },
                        {
                            stop_id: "E215",
                            stop_name: "大町",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U215","D141"]
                        },
                        {
                            stop_id: "E141",
                            stop_name: "新鎌ヶ谷",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,-1L-3,-3H3L4,-1 M-4,1L-3,3H3L4,1 M-5.5,1L-4.5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U141","D142"]
                        },
                        {
                            stop_id: "E142",
                            stop_name: "西白井",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U142","D216"]
                        },
                        {
                            stop_id: "E216",
                            stop_name: "白井",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U216","D149"]
                        },
                        {
                            stop_id: "E149",
                            stop_name: "小室",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,-1L-3,-3H3L4,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U149","D143"]
                        },
                        {
                            stop_id: "E143",
                            stop_name: "千葉NT",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U143","D144"]
                        },
                        {
                            stop_id: "E144",
                            stop_name: "印西牧原",
                            tracks: "M-6,-1H-4.5L-3.5,-3H5L6,-1 M-6,1H-4.5L-3.5,3H5L6,1 M-6,-1L-5,1 M-6,1L-5,-1 M-3,3L-2,1H5 M-3,-3L-2,-1H5 M2,3L3,1 M2,1L3,3 M2,-3L3,-1 M2,-1L3,-3 M3.5,-1L4.5,1 M3.5,1L4.5,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U144","D145"]
                        },
                        {
                            stop_id: "E145",
                            stop_name: "印旛日医",
                            tracks: "M-6,-1H6 M-6,1H6 M-4,-1L-3,1 M2.5,-1L3,-0.5H6 M2.5,1L3,0.5H6 M3,0.5L3.5,-0.5 M3,-0.5L3.5,0.5",
                            plats: [0]
                        },
                        {
                            section_id: ["U145","D146"]
                        },
                        {
                            stop_id: "E146",
                            stop_name: "成田湯川",
                            tracks: "M-6,-1H5L6,0 M-6,1H4L5,-1 M-3.5,-1L-2.5,-3H2.5L3.5,-1 M-3.5,1L-2.5,3H2.5L3.5,1 M-6,1L-5,-1",
                            plats: [-2,2]
                        },
                        {
                            section_id: ["D147"]
                        },
                        {
                            stop_id: "E147",
                            stop_name: "根古屋",
                            tracks: "M-6,0L-5,-1H5L6,0 M-4,-1L-3,1H3L4,-1",
                            plats: []
                        },
                        {
                            section_id: ["S044"]
                        },
                        {
                            stop_id: "E044",
                            stop_name: "空２ビル",
                            tracks: "M-6,0H-4L-3,-1H3L4,0H6 M-4,0L-3,1H3L4,0 M-5,3L-4,1H-3 M-6,3L-4.5,0",
                            plats: [0]
                        },
                        {
                            section_id: ["D045"]
                        },
                        {
                            stop_id: "E045",
                            stop_name: "成田空港",
                            tracks: "M-6,0L-5,-1H6 M-6,0L-5,1H6 M-4,1L-3,3H4",
                            plats: [0,1]
                        },
                        {
                            stop_id: "E045b",
                            stop_name: "",
                            tracks: "M-6,-1H4 M-6,1H4",
                            plats: [0]
                        }
                    ]
                },
                "chiba":
                {
                    uri: "chiba",
                    line_id: "chiba",
                    line_name: "千葉線",
                    sections:
                    [
                        {
                            stop_id: "E027",
                            stop_name: "津田沼",
                            tracks: "M-6,-1H6 M-6,1L-4,5H4L4.5,4H5.5 M-6,-5L-5,-3H3L4,-1 M-4,-3L-3,-5H3 M-3,-1L-2,1H4L5,3H5.5 M-6,1H-3L-2,3H4L5,1H6 M2.5,-1L3.5,1 M2.5,1L3.5,-1 M2.5,3L3.5,5 M2.5,5L3.5,3 M5,-1L6,1 M-6,0H-2.5 M-3.5,0L-3,1",
                            plats: [-2,0,2]
                        },
                        {
                            section_id: ["K027","D054"]
                        },
                        {
                            stop_id: "E054",
                            stop_name: "幕張本郷",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U054","D055"]
                        },
                        {
                            stop_id: "E055",
                            stop_name: "京成幕張",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [0]
                        },
                        {
                            section_id: ["U055","D056"]
                        },
                        {
                            stop_id: "E056",
                            stop_name: "検見川",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U056","D057"]
                        },
                        {
                            stop_id: "E057",
                            stop_name: "京成稲毛",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U057","D058"]
                        },
                        {
                            stop_id: "E058",
                            stop_name: "みどり台",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U058","D059"]
                        },
                        {
                            stop_id: "E059",
                            stop_name: "西登戸",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U059","D060"]
                        },
                        {
                            stop_id: "E060",
                            stop_name: "新千葉",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U060","D061"]
                        },
                        {
                            stop_id: "E061",
                            stop_name: "京成千葉",
                            tracks: "M-6,-1H6 M-6,1H6",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["U061","D062"]
                        },
                        {
                            stop_id: "E062",
                            stop_name: "千葉中央",
                            tracks: "M-6,-1H5L6,0 M-6,1H6 M-4,-1L-3,1 M-4,1L-3,-1 M3,-1L4,1 M3,1L4,-1",
                            plats: [-1,1]
                        },
                        {
                            section_id: ["D084"]
                        },
                        {
                            stop_id: "E084",
                            stop_name: "千葉寺",
                            tracks: "M-6,0L-5,-1H5L6,0",
                            plats: [-1]
                        },
                        {
                            section_id: ["D080"]
                        },
                        {
                            stop_id: "E080",
                            stop_name: "大森台",
                            tracks: "M-6,0L-5,-1H5L6,0 M-4,-1L-3,1H3L4,-1",
                            plats: [0]
                        },
                        {
                            section_id: ["D081"]
                        },
                        {
                            stop_id: "E081",
                            stop_name: "学園前",
                            tracks: "M-6,0L-5,-1H5L6,0 M-4,-1L-3,1H3L4,-1",
                            plats: [0]
                        },
                        {
                            section_id: ["D082"]
                        },
                        {
                            stop_id: "E082",
                            stop_name: "おゆみ野",
                            tracks: "M-6,0L-5,-1H5L6,0",
                            plats: [-1]
                        },
                        {
                            section_id: ["D083"]
                        },
                        {
                            stop_id: "E083",
                            stop_name: "ちはら台",
                            tracks: "M-6,0L-5,-1H4 M-4,-1L-3,1H4",
                            plats: [0]
                        }
                    ]
                }
            }

        const ik_list =
            {
                "0":["",""],
                "1":["京成上野","上"],
                "3":["日暮里","日暮"],
                "4":["新三河島","新三"],
                "5":["町屋","町"],
                "6":["千住大橋","千住"],
                "7":["京成関屋","関"],
                "8":["堀切菖蒲園","堀切"],
                "9":["お花茶屋","花"],
                "10":["青砥","青"],
                "11":["京成高砂","高"],
                "12":["京成小岩","小岩"],
                "13":["江戸川","江"],
                "14":["国府台","国"],
                "15":["市川真間","市"],
                "16":["菅野","菅"],
                "17":["京成八幡","八幡"],
                "18":["鬼越","鬼"],
                "19":["京成中山","中"],
                "20":["東中山","東中"],
                "21":["京成西船","西船"],
                "22":["海神","海"],
                "23":["京成船橋","船橋"],
                "24":["大神宮下","大神"],
                "25":["船橋競馬場","船競"],
                "26":["谷津","谷"],
                "27":["京成津田沼","津"],
                "28":["京成大久保","大久"],
                "29":["実籾","実"],
                "30":["八千代台","八千"],
                "31":["京成大和田","大和"],
                "32":["勝田台","勝"],
                "33":["志津","志"],
                "34":["ユーカリが丘","ユ"],
                "35":["京成臼井","う"],
                "36":["京成佐倉","佐"],
                "37":["大佐倉","大佐"],
                "38":["京成酒々井","酒"],
                "39":["宗吾参道","宗"],
                "40":["公津の杜","公津"],
                "41":["京成成田","成"],
                "43":["",""],
                "44":["空港第2ビル","空2"],
                "45":["成田空港","空"],
                "46":["東成田","東成"],
                "47":["押上","押"],
                "48":["京成曳舟","曳"],
                "49":["八広","八広"],
                "50":["四ツ木","四"],
                "51":["京成立石","立"],
                "52":["柴又","柴"],
                "53":["京成金町","金"],
                "54":["京成幕張本郷","本郷"],
                "55":["京成幕張","幕張"],
                "56":["検見川","検"],
                "57":["京成稲毛","稲"],
                "58":["みどり台","み"],
                "59":["西登戸","西登"],
                "60":["新千葉","新千"],
                "61":["京成千葉","千葉"],
                "62":["千葉中央","千中"],
                "80":["大森台","大森"],
                "81":["学園前","学"],
                "82":["おゆみ野","おゆ"],
                "83":["ちはら台","ち"],
                "84":["千葉寺","千寺"],
                "90":["西馬込","西"],
                "91":["泉岳寺","泉"],
                "92":["浅草橋","浅橋"],
                "93":["蔵前","蔵"],
                "94":["浅草","浅草"],
                "95":["本所吾妻橋","吾"],
                "100":["品川","品"],
                "101":["京急川崎","川崎"],
                "102":["神奈川新町","神"],
                "103":["金沢文庫","文"],
                "104":["堀ノ内","堀ノ"],
                "105":["浦賀","浦"],
                "106":["横浜","横"],
                "107":["子安","子"],
                "110":["京急久里浜","久"],
                "111":["三浦海岸","海"],
                "112":["三崎口","三"],
                "113":["",""],
                "120":["逗子・葉山","逗葉"],
                "121":["羽田空港","羽"],
                "122":["",""],
                "130":["芝山千代田","芝"],
                "131":["新津田沼","新津"],
                "132":["高根公団","公団"],
                "133":["鎌ヶ谷大仏","大仏"],
                "134":["くぬぎ山","く"],
                "135":["八柱","八柱"],
                "136":["松戸","松"],
                "140":["矢切","矢"],
                "141":["新鎌ヶ谷","新鎌"],
                "142":["西白井","西白"],
                "143":["千葉ニュータウン中央","NT"],
                "144":["印西牧の原","牧"],
                "145":["印旛日本医大","日"],
                "146":["成田湯川","湯"],
                "147":["",""],
                "148":["東松戸","東松"],
                "149":["小室","小室"],
                "150":["",""],
                "151":["",""]
            };

        const sy_list = 
            {
                "0":["スカイライナー","Ｓ"],
                "1":["モーニングライナー","Ｍ"],
                "2":["イブニングライナー","Ｅ"],
                "3":["通勤特急","通特"],
                "4":["特急","特"],
                "5":["急行","急"],
                "6":["普通","普"],
                "7":["A","A"],
                "8":["B","B"],
                "9":["C","C"],
                "10":["快速","快"],
                "11":["快速","快"],
                "13":["快速特急","快特"],
                "14":["快速特急","快特"],
                "15":["快速特急","快特"],
                "16":["シティライナー","Ｃ"],
                "17":["アクセス特急","ア特"],
                "18":["アクセス特急","ア特"],
                "99":["回送","回"]
            }

        const sta_list =
            {
                "keisei" : [
                    "E001","E002","E003","E004","E005","E006","E007","E008","E009","E010","E011","E012","E013","E014","E015","E016","E017","E018","E019","E020","E021","E022","E023","E024","E025","E026","E027","E028","E029","E030","E031","E032","E033","E034","E035","E036","E037","E038","E039","E040","E041","E043","E046","E130"
                ],
                "oshiage" : [
                    "E047","E048","E049","E050","E051","E010"
                ],
                "hokuso" : [
                    "E010","E011","E211","E140","E212","E213","E148","E214","E215","E141","E142","E216","E149","E143","E144","E145","E146","E147","E044","E045","E044b","E045b"
                ],
                "chiba" : [
                    "E027","E054","E055","E056","E057","E058","E059","E060","E061","E062","E080","E081","E082","E083","E084"
                ]
            }
        const sec_list =
            {
                "keisei" : ["U001","U003","U004","U005","U006","U007","U008","U009","U010","U011","U012","U013","U014","U015","U016","U017","U018","U019","U020","U021","U022","U023","U024","U025","U026","U027","U028","U029","U030","U031","U032","U033","U034","U035","U036","U037","U038","U039","U040","U041","K043","U046",
                    "V010","W011","D003","D004","D005","D006","D007","D008","D009","D010","D011","D012","D013","D014","D015","D016","D017","D018","D019","D020","D021","D022","D023","D024","D025","D026","D027","D028","D029","D030","D031","D032","D033","D034","D035","D036","D037","D038","D039","D040","D041","D043","D046","D130"
                ],
                "oshiage" : [
                    "U047","U048","U049","U050","U051","S010","D048","D049","D050","D051",
                ],
                "hokuso" : [
                    "V010","U010", "D011","W011","D211","D140","D212","D213","D148","D214","D215","D141","D142","D216","D149","D143","D144","D145","D146","D147","S044","D045",
                    "K011","U140","U212","U213","U148","U214","U215","U141","U142","U216","U149","U143","U144","U145","U146","U147","U044","U045",
                ],
                "chiba" : [
                    "D054","D055","D056","D057","D058","D059","D060","D061","D062","D084","D080","D081","D082","D083",
                    "K027","U054","U055","U056","U057","U058","U059","U060","U061","U084","U080","U081","U082","U083","U062"
                ]
                
            }
        
        const url_list = [
            "https://zaisen.tid-keisei.jp/data/traffic_info.json?ts=170929873676",
        ]
        var curline;

        function createSVG(tag)
            {
                return document.createElementNS("http://www.w3.org/2000/svg", tag);
            }

        function init()
        {   
            curline = location.search;
            if (curline.length > 0)
                curline = curline.substring(1);

            var sel = document.getElementById("sel");
            Object.keys(linedata).forEach(function (o, i, a)
            {
                var btn = document.createElement("button");
                btn.className = "line" + linedata[o].line_id;
                btn.addEventListener("click", function () { trans(o); });
                btn.innerHTML = linedata[o].line_name;
                if (o == curline)
                    btn.disabled = true;
                sel.appendChild(btn);
            });

            if (!curline in linedata)
                return;

            var main = document.getElementById("main");
            linedata[curline].sections.forEach(function (o, i, a)
            {
                var sec = document.createElement("div");
                sec.style.height = "192px";
                sec.style.cssFloat = "left";
                sec.style.position = "relative";
                var svg = createSVG("svg");
                svg.setAttribute("height", "192px");
                if ('stop_id' in o)
                {
                    sec.style.width = "192px";
                    svg.setAttribute("width", "192px");
                    svg.setAttribute("viewBox", "-96 -96 192 192");

                    var text = createSVG("text");
                    text.setAttribute("x", 0);
                    text.setAttribute("y", 6);
                    text.setAttribute("font-size", 14);
                    text.setAttribute("font-weight", "bold");
                    text.setAttribute("color", "black");
                    text.setAttribute("text-anchor", "middle");
                    text.innerHTML = o.stop_name;
                    svg.appendChild(text);

                    if ("tracks" in o)
                    {
                        var track = createSVG("path");
                        track.setAttribute("d", o.tracks);
                        track.setAttribute("stroke", "black");
                        track.setAttribute("stroke-width", 0.125);
                        track.setAttribute("fill", "none");
                        track.setAttribute("transform", "scale(16)");
                        svg.appendChild(track);
                    }

                    if ("plats" in o)
                    {
                        o.plats.forEach(function (p, i, a)
                        {
                            var plat = createSVG("rect");
                            plat.setAttribute("x", -31.5);
                            plat.setAttribute("y", p * 32 - 9.5);
                            plat.setAttribute("width", 63);
                            plat.setAttribute("height", 19);
                            plat.setAttribute("stroke", "black");
                            plat.setAttribute("stroke-width", 1);
                            plat.setAttribute("fill", "none");
                            svg.appendChild(plat);
                        });
                    }

                    for (var i = -3; i <= 3; ++i)
                    {
                        if (i == 0)
                            continue;
                        var canv = document.createElement("div");
                        canv.id = o.stop_id + "p" +i;
                        canv.className = "section";
                        canv.style.top = i * 32 + (i < 0 ? 64 : 32) + "px";
                        canv.style.left = "64px";
                        sec.appendChild(canv);
                    }
                }
                if ('section_id' in o)
                {
                    sec.style.width = "64px";
                    svg.setAttribute("width", "64px");
                    svg.setAttribute("viewBox", "-32 -96 64 192");

                    o.section_id.forEach(function (s, i, a)
                    {
                        if (s == -1)
                            return;

                        var line = createSVG("line");
                        line.setAttribute("x1", -64);
                        line.setAttribute("y1", (i - a.length / 2) * -32 - 16);
                        line.setAttribute("x2", 64);
                        line.setAttribute("y2", (i - a.length / 2) * -32 - 16);
                        line.setAttribute("stroke", "black");
                        line.setAttribute("stroke-width", 2);
                        svg.appendChild(line);

                        var canv = document.createElement("div");
                        canv.id = "sec" + s;
                        canv.className = "section";
                        canv.style.top = (i - a.length / 2) * -32 + 32 + "px";
                        canv.style.left = "0";
                        sec.appendChild(canv);
                    });
                }
                sec.insertBefore(svg, sec.firstChild);
                main.appendChild(sec);
            });

            update();
            setInterval(update, 10000);
        }

        var request = null;
		function update()
		{
            for (let urln = 0; urln < 2; urln++){
                if (request != null)
                    return;

                request = new XMLHttpRequest();
                request.open("GET", url_list[urln], true);
                request.onreadystatechange = function ()
                {
                    if (request.readyState != 4 || request.status != 200)
                        return;
                    var res = JSON.parse(request.responseText);

                    linedata[curline].sections.forEach(function (o, i, a)
                    {
                        if ('stop_id' in o )
                        {
                            for (let i=-3; i<=3; ++i)
                            {
                                var p = o.stop_id + "p" +i
                                var elem = document.getElementById(p);
                                if (elem != null)
                                {
                                    while (elem.lastChild)
                                        elem.removeChild(elem.lastChild);
                                }
                            }
                        }

                        if ('section_id' in o)
                        {
                            for (let i=0; i<4; ++i){
                                var q = "sec" + o.section_id[i];
                                var elem = document.getElementById(q);
                                if (elem != null)
                                {
                                    while (elem.lastChild)
                                            elem.removeChild(elem.lastChild);
                                }
                            }
                        }
                    });
                    var elem = document.getElementById("log");
                        if (elem != null)
                            elem.innerText = "";

                    elem = document.getElementById("headtime");
                    if (elem != null)
                        elem.innerText = "";

                    var date = res.UP[0].dt[0]

                    var updatetime = document.createElement("div");
                    updatetime.className = "updatetime";
                    updatetime.innerHTML = "<div style=\"text-align: left;\">" + date.yy +"/"+ date.mt +"/"+ date.dy +" "+ date.hh +":"+ date.mm +":"+ date.ss +"</div>";
                    document.getElementById("headtime").appendChild(updatetime)

                    res.TS.forEach(function (o, i, a) //駅停車中分処理
                    {
                        //console.log(sta_list.keisei.includes(o.id)) sta_list.keisei に o.id が含まれて"いなければ"処理終了
                        if(!(sta_list[curline].includes(o.id)))
                            return;
                        var c = o.tr.length;
                        for(let nm=0; nm < c; ++nm)
                        {

                            var tra = document.createElement("div");
                            tra.className = "train line" + linedata[curline].line_id +" ksy"+o.tr[nm].sy;
                            var box = document.createElement("div");

                            var sr_add = ""
                            if ("sr" in o.tr[nm] && o.tr[nm].sr!= "" && o.tr[nm].sr != "99") //両数追加
                            {
                                var sr_list = {"0":"","2":"②","4":"④","6":"⑥","8":"⑧"};
                                sr_add = sr_list[o.tr[nm].sr];
                            }
                            box.className = "box";
                            box.innerHTML = "<div style=\"text-align: left;\">" + o.tr[nm].no + sr_add +"</div>";


                            //console.log(o.tr[0].no) //列番log表示
                            tra.appendChild(box);
                            var dir = document.createElement("div");
                            dir.className = (o.tr[nm].hk == 0 ? "up" : "down");
                            tra.appendChild(dir);
                            if (o.tr[nm].dl != "0")
                            {
                                var delay = document.createElement("div");
                                delay.className = "delay";
                                delay.innerHTML = "+" + o.tr[nm].dl;
                                tra.appendChild(delay);
                            }

                            var info = document.createElement("div");
                            info.className = "info";

                            if ("sy" in o.tr[nm] && o.tr[nm].sy!= "")
                            {
                                sy_add = sy_list[o.tr[nm].sy][1]
                                info.innerHTML += sy_add
                            }

                            if ("ik" in o.tr[nm] && o.tr[nm].ik!= "" && o.tr[nm].ik != "99")
                            {
                                ik_add = ik_list[o.tr[nm].ik][1]
                                info.innerHTML += ik_add
                            }

                            if (info.innerHTML != "")
                            tra.appendChild(info);


                            var elem;
                            if ("id" in o && o.id != null)
                            {
                                var x = {"2":-1 , "1":1}//基本:Up:1 Dn:2
                                var p = o.tr[nm].bs;
                                var i = x[p];
                                //console.log(i) 番線id
                                
                                if(o.id == "E003" && p == 3) //日暮里駅例外処理 Up:1 Dn:3
                                    i = -1;
                                if(o.id == "E010") //青砥駅例外処理 Up:1 Dn:2 
                                    i = i + 2;
                                
                                //上野、千住大橋、青砥、高砂、小岩、市川真間、東中山、押上
                                if(o.id == "E001" || o.id == "E006" || o.id == "E010" || o.id == "E011" || o.id == "E012" || o.id == "E015" || o.id == "E020" || o.id == "E047") 
                                {
                                x = {"4":-2, "3":-1, "2":1, "1":2}
                                i = x[p]
                                }

                                //船橋競馬、八千代台、京成佐倉、東成田
                                if(o.id == "E025" || o.id == "E030" || o.id == "E036" || o.id == "E046" || o.id == "E140" || o.id == "E148" || o.id == "E141" || o.id == "E144" || o.id == "E146") 
                                {
                                x = {"4":-2, "3":-1, "2":1, "1":2}
                                i = x[p]
                                }

                                //津田沼
                                if(o.id == "E027")
                                {
                                    x = {"6":-3, "5":-2, "4":-1, "3":1, "2":2, "1":3}
                                    i = x[p]
                                }

                                //芝山、千葉寺、おゆみ野
                                if(o.id == "E130" || o.id == "E084" || o.id == "E082")
                                {
                                    i = -1
                                }
                                //八広3T
                                if(o.id == "E049" && p == "3")
                                {
                                    i = -2
                                }

                                //ユーカリが丘、宗吾参道、成田
                                if(o.id == "E034" || o.id == "E039" || o.id == "E041")
                                {
                                    x = {"3":-1, "2":1, "1":2}
                                    i = x[p]
                                }
                                //小室
                                if(o.id == "E149")
                                {
                                    x = {"3":-2, "2":-1, "1":1}
                                    i = x[p]
                                }

                                if(o.id == "E011" && p == 5) //高砂5番(金町)
                                    i = -3;
                        
                                elem = o.id + "p" + i; //ホームid

                                //成田空港

                                if(o.id == "E045")
                                {
                                    x = {"1":2, "2":1, "3":-1}
                                    elem = "E045" + "p" + x[p];
                                }
                                if(o.id == "E045" && p == 4){
                                    elem = "E045b" + "p" + 1;
                                }
                                if(o.id == "E045" && p == 5){
                                    elem = "E045bp-1";
                                }

                                //console.log(elem) 
                                
                            }
                            if (document.getElementById(elem) != null){
                                document.getElementById(elem).appendChild(tra)
                            }
                            else
                                document.getElementById("log").innerText += "Unknown: " + elem + "\t" + JSON.stringify(o) + "\n";
                        }
                    });


                    res.EK.forEach(function (o, i, a) //駅間走行中分処理
                    {
                        if(!(sec_list[curline].includes(o.id)))
                            return;
                        var c = o.tr.length;
                        for(let nm=0; nm < c; ++nm)
                        {
                            var tra = document.createElement("div");
                            tra.className = "train line" + linedata[curline].line_id +" ksy"+o.tr[nm].sy;
                            var box = document.createElement("div");

                            var sr_add = ""
                            if ("sr" in o.tr[nm] && o.tr[nm].sr!= "" && o.tr[nm].sr != "99") //両数追加
                            {
                                var sr_list = {"0":"","2":"②","4":"④","6":"⑥","8":"⑧"};
                                sr_add = sr_list[o.tr[nm].sr];
                            }
                            box.className = "box";
                            box.innerHTML = "<div style=\"text-align: left;\">" + o.tr[nm].no + sr_add +"</div>";

                            //console.log(o.tr[0].no) //列番log表示
                            tra.appendChild(box);
                            var dir = document.createElement("div");
                            dir.className = (o.tr[nm].hk == 0 ? "up" : "down");
                            tra.appendChild(dir);
                            if (o.tr[nm].dl != "0")
                            {
                                var delay = document.createElement("div");
                                delay.className = "delay";
                                delay.innerHTML = "+" + o.tr[nm].dl;
                                tra.appendChild(delay);
                            }

                            var info = document.createElement("div");
                            info.className = "info";

                            if ("sy" in o.tr[nm] && o.tr[nm].sy!= "")
                            {
                                sy_add = sy_list[o.tr[nm].sy][1]
                                info.innerHTML += sy_add
                            }

                            if ("ik" in o.tr[nm] && o.tr[nm].ik!= "" && o.tr[nm].ik != "99")
                            {
                                ik_add = ik_list[o.tr[nm].ik][1]
                                info.innerHTML += ik_add
                            }

                            if (info.innerHTML != "")
                            tra.appendChild(info);

                            var elem;
                            if ("id" in o && o.id != null)
                            {
                                elem = "sec" + o.id;
                                if(o.id == "D130")
                                    elem = "secU046"
                                if(o.id == "U146")
                                    elem = "secD147"
                                if(o.id == "U147")
                                    elem = "secS044"
                                if(o.id == "U044")
                                    elem = "secD045"
                                if(o.id == "U062")
                                    elem = "secD084"
                                if(o.id == "U062")
                                    elem = "secD084"
                                if(o.id == "U084")
                                    elem = "secD080"
                                if(o.id == "U080")
                                    elem = "secD081"
                                if(o.id == "U081")
                                    elem = "secD082"
                                if(o.id == "U082")
                                    elem = "secD083"
                            }
                            if (document.getElementById(elem) != null){
                                document.getElementById(elem).appendChild(tra)
                            }
                            else
                                document.getElementById("log").innerText += "Unknown: " + elem + "\t" + JSON.stringify(o) + "\n";
                        }
                    });
                    request = null;
                };
                request.send(null);
            }
		}

        function trans(line)
        {
            if (curline != line)
                location.search = line;
        }
        document.addEventListener("DOMContentLoaded", init, false);
        </script>
</head>
<body>
    <div id="sel" style="padding-bottom: 32px;">
	<button type="button" onclick="location.href='toppage.html'">戻る</button>

    <!--
    <button type="button" onclick="window.open('https://loo-ool.com/rail/KS/')">運用</button>
    -->
    <!--
    <button type="button" onclick="location.href='matsudo.html'">松戸線</button>
	-->

    </div>
    <div id="headtime"></div>
    <div id="message"></div>
    </div>
	<div id="main"></div>
	<div id="log" style="clear: left;"></div>

    <script type="text/javascript">
        let n = 20;
        sec = document.createElement("div")
        let text = "";
        text_info= "";
        text = text+text_info
        let longText = Array.from({ length: n })
        .map((i) => text)
        .reduce((a, b) => a + "&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;" + b, "&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;");

        const message = document.getElementById("message");
        message.innerHTML = '<div class="first">'+longText+'</div><div class="second">'+longText+'</div>';
    
        // トークン検証
        const as = localStorage.getItem('authToken');
        const tokenExpiry = localStorage.getItem('tokenExpiry');

        if (!as || !tokenExpiry || Date.now() > tokenExpiry) {
          // 無効な場合はログインページへ
          alert('セッションが切れました');
          window.location.href = 'index.html';
        }
    </script>
</body>
</html>
